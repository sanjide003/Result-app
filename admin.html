<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sadaye Madeena 2k25 - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- PapaParse CSV Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.4.1/papaparse.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Modern Button Styles */
        .btn { @apply inline-flex items-center justify-center px-5 py-2.5 rounded-lg font-semibold text-white shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-opacity-75 transition-all duration-300 ease-in-out; transform: translateZ(0); }
        .btn:hover { @apply shadow-xl -translate-y-0.5; }
        .btn:active { @apply shadow-md translate-y-0; }
        .btn i:not(.password-toggle-icon) { @apply mr-2 -ml-1 h-5 w-5; } /* Icon spacing, exclude toggle */
        .btn-primary { @apply bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 focus:ring-indigo-500; }
        .btn-danger { @apply bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 focus:ring-red-500; }
        .btn-secondary { @apply bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 focus:ring-gray-500; }
        .btn-light { @apply bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 focus:ring-indigo-500; }
        .btn-success { @apply bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 focus:ring-green-500; }
        .btn-sm { @apply px-3 py-1.5 text-sm; }
        .btn-icon-only { @apply p-2; }
        .btn-icon-only i { @apply m-0 h-5 w-5; }
        
        /* Modern Form & Card Styles */
        .form-input, .form-select, .form-textarea { @apply block w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500; transition: all 0.2s ease-in-out; }
        .form-label { @apply block text-sm font-medium text-gray-700 mb-1.5; }
        .card { @apply bg-white shadow-xl rounded-2xl p-6 md:p-8; }
        .card-header { @apply text-2xl font-bold text-gray-900 mb-6; }
        /* Password input wrapper */
        .password-wrapper { @apply relative; }
        .password-toggle-btn { @apply absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 cursor-pointer; }
        
        /* Malayalam Instruction Box */
        .info-text { @apply bg-blue-50 text-blue-800 p-4 border border-blue-200 rounded-lg text-sm mb-6; }
        .info-text strong { @apply font-semibold; }

        /* Menu Overlay Styles */
        .menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); backdrop-filter: blur(4px); z-index: 1001; display: none; justify-content: center; align-items: flex-start; padding-top: 80px; opacity: 0; transition: opacity 0.3s ease; }
        .menu-box { background: white; width: 90%; max-width: 350px; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.15); padding: 15px; transform: translateY(-20px); opacity: 0; transition: all 0.3s ease-out; }
        .menu-box.open { transform: translateY(0); opacity: 1; }
        .menu-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; margin-bottom: 10px; border-bottom: 1px solid #e2e8f0; }
        .menu-header .header-title { font-weight: bold; font-size: 1.2em; color: #1e293b; }
        .close-btn { background: none; border: none; font-size: 2em; cursor: pointer; color: #64748b; }
        .menu-link { display: flex; align-items: center; padding: 12px 15px; text-decoration: none; color: #334155; font-weight: 500; border-radius: 8px; transition: background-color 0.2s, color 0.2s; font-size: 1.1em; }
        .menu-link:hover { background-color: #f1f5f9; }
        .menu-link.active { background-color: #4f46e5; color: white; font-weight: bold; }
        .menu-link i { @apply w-6 mr-3 text-center text-gray-500; }
        .menu-link.active i { @apply text-white; }
        
        /* Custom file input */
        .file-input-label { @apply btn btn-light text-base; cursor: pointer; }
        .file-input-label i { @apply mr-2; }
        .file-input-filename { @apply text-sm text-gray-500 ml-4; }

        /* Styling for list items (programs, categories, teams) */
        .list-item { @apply flex items-center justify-between p-4 border border-gray-200 rounded-lg mb-3 bg-white; }
        .list-item-content { @apply flex-grow mr-4; }
        .list-item-name { @apply font-semibold text-gray-800; }
        .list-item-details { @apply text-sm text-gray-500; }
        .list-item-actions { @apply flex-shrink-0; }

    </style>
</head>
<body class="bg-gray-100">

    <!-- Login Page -->
    <div id="login-page" class="min-h-screen flex items-center justify-center bg-gray-200 p-4">
        <div class="w-full max-w-md">
            <!-- Login Card -->
            <div class="card mb-6">
                <h2 class="card-header text-center">Admin Panel Login</h2>
                <form id="login-form">
                    <div class="mb-4">
                        <label for="login-email" class="form-label">Email</label>
                        <input type="email" id="login-email" class="form-input" required placeholder="your@email.com">
                    </div>
                    <div class="mb-6">
                        <label for="login-password" class="form-label">Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="login-password" class="form-input pr-10" required placeholder="••••••••">
                            <button type="button" class="password-toggle-btn" onclick="togglePasswordVisibility('login-password', this)">
                                <i class="fas fa-eye password-toggle-icon"></i>
                            </button>
                        </div>
                    </div>
                    <!-- UPDATED: Button Style -->
                    <button type="submit" class="btn btn-primary w-full"><i class="fas fa-sign-in-alt"></i>Login</button>
                </form>
            </div>
            <!-- Register Card -->
            <div class="card">
                <h2 class="card-header text-center text-xl">Register New Admin <span class="text-sm font-normal text-gray-500">(First Use Only)</span></h2>
                 <form id="register-form">
                    <div class="mb-4">
                        <label for="register-email" class="form-label">Email</label>
                        <input type="email" id="register-email" class="form-input" required placeholder="newadmin@email.com">
                    </div>
                    <div class="mb-6">
                        <label for="register-password" class="form-label">Password</label>
                         <div class="password-wrapper">
                            <input type="password" id="register-password" class="form-input pr-10" required placeholder="Choose a strong password">
                            <button type="button" class="password-toggle-btn" onclick="togglePasswordVisibility('register-password', this)">
                                <i class="fas fa-eye password-toggle-icon"></i>
                            </button>
                        </div>
                    </div>
                     <!-- UPDATED: Button Style -->
                    <button type="submit" class="btn btn-secondary w-full"><i class="fas fa-user-plus"></i>Register</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Panel (Hidden by default) -->
    <div id="admin-panel" class="hidden min-h-screen">
        
        <!-- Menu Overlay -->
        <div id="admin-menu-overlay" class="menu-overlay">
            <div id="admin-menu-box" class="menu-box">
                <div class="menu-header">
                    <span class="header-title">ADMIN MENU</span>
                    <button id="admin-menu-close-btn" class="close-btn">&times;</button>
                </div>
                <a href="#dashboard" data-target="page-dashboard" class="menu-link active"><i class="fas fa-home"></i>Home Page Settings</a>
                <a href="#participants" data-target="page-participants" class="menu-link"><i class="fas fa-id-card"></i>Participants Import</a>
                <a href="#programs" data-target="page-programs" class="menu-link"><i class="fas fa-calendar-alt"></i>Programs & Categories</a>
                <a href="#teams" data-target="page-teams" class="menu-link"><i class="fas fa-users"></i>Manage Teams</a>
                <a href="#results" data-target="page-results" class="menu-link"><i class="fas fa-poll"></i>Publish Results</a>
                <div class="mt-6 border-t pt-4">
                     <button id="logout-button" class="w-full btn btn-danger"><i class="fas fa-sign-out-alt"></i>Logout</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="main-content">
            <!-- Top Bar -->
            <header class="bg-white shadow-md sticky top-0 z-10">
                 <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center h-16">
                        <div class="flex items-center">
                             <button id="admin-menu-btn" class="text-gray-500 focus:outline-none focus:text-gray-700 mr-4">
                                <i class="fas fa-bars text-xl"></i>
                            </button>
                            <h1 class="text-xl font-bold text-gray-800">Admin Panel</h1>
                        </div>
                        <div class="text-sm text-gray-600" id="admin-email"></div>
                    </div>
                 </div>
            </header>
            
            <!-- Page Content Area -->
            <main class="p-4 md:p-8 lg:p-10 max-w-4xl mx-auto"> 
                
                {/* --- Home Page Settings --- */}
                <div id="page-dashboard" class="admin-page">
                    {/* ... [Home page content unchanged] ... */}
                     <h1 class="text-3xl font-bold text-gray-900 mb-6">Home Page Settings</h1>
                    <div class="info-text">
                       <strong>നിർദ്ദേശം:</strong> വെബ്സൈറ്റിന്റെ പ്രധാന പേജിൽ (ഹോം പേജ്) കാണിക്കേണ്ട വിവരങ്ങൾ ഇവിടെ നൽകുക. ലോഗോ, പ്രധാന തലക്കെട്ട്, ഉപ തലക്കെട്ട്, എബൗട്ട് വിവരണം, എബൗട്ട് ചിത്രം, ഗാലറി ചിത്രങ്ങൾ, സ്ഥിതിവിവരക്കണക്കുകൾ (ടെക്സ്റ്റ്) എന്നിവ ഇവിടെ മാറ്റം വരുത്താം. ചിത്രങ്ങളുടെ URL (ലിങ്ക്) ആണ് നൽകേണ്ടത്.
                    </div>
                    <form id="form-homepage">
                        <div class="card mb-6">
                            <h2 class="card-header">Header Content</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                                <div>
                                    <label for="homepage-logo-url" class="form-label">Logo Image URL</label>
                                    <input type="url" id="homepage-logo-url" class="form-input" placeholder="https://example.com/logo.png">
                                </div>
                                <div>
                                    <label for="homepage-main-title" class="form-label">Main Title</label>
                                    <input type="text" id="homepage-main-title" class="form-input" placeholder="e.g., Sadaye Madeena 2k25">
                                </div>
                            </div>
                            <div>
                                <label for="homepage-subtitle" class="form-label">Subtitle</label>
                                <input type="text" id="homepage-subtitle" class="form-input" placeholder="e.g., Inter-Madrasa Art Fest">
                            </div>
                        </div>

                        <div class="card mb-6">
                            <h2 class="card-header">About Section</h2>
                            <div class="mb-4">
                                <label for="homepage-about" class="form-label">About The Fest (Description)</label>
                                <textarea id="homepage-about" class="form-textarea" rows="5" placeholder="Write something about the event..."></textarea>
                            </div>
                            <div>
                                <label for="homepage-about-image-url" class="form-label">About Section Image URL</label>
                                <input type="url" id="homepage-about-image-url" class="form-input" placeholder="https://example.com/about-image.jpg">
                            </div>
                        </div>

                        <div class="card mb-6">
                            <h2 class="card-header">Statistics Texts</h2>
                             <p class="text-sm text-gray-500 mb-4">ഹോം പേജിൽ കാണിക്കേണ്ട സ്ഥിതിവിവരക്കണക്കുകൾ ടെക്സ്റ്റ് ആയി ഇവിടെ നൽകുക (ഉദാ: '50+', '150+').</p>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                                <div>
                                    <label for="homepage-total-programs" class="form-label">Total Programs</label>
                                    <input type="text" id="homepage-total-programs" class="form-input" placeholder="e.g., 50+">
                                </div>
                                <div>
                                    <label for="homepage-total-participants" class="form-label">Total Contestants</label>
                                    <input type="text" id="homepage-total-participants" class="form-input" placeholder="e.g., 200+">
                                </div>
                                <div>
                                    <label for="homepage-total-categories" class="form-label">Total Categories</label>
                                    <input type="text" id="homepage-total-categories" class="form-input" placeholder="e.g., 5">
                                </div>
                                <div>
                                    <label for="homepage-total-teams" class="form-label">Total Teams</label>
                                    <input type="text" id="homepage-total-teams" class="form-input" placeholder="e.g., 3">
                                </div>
                            </div>
                        </div>

                        <div class="card mb-6">
                             <h2 class="card-header">Image Gallery URLs</h2>
                            <label for="homepage-gallery" class="form-label">Enter Image URLs (One URL per line)</label>
                            <textarea id="homepage-gallery" class="form-textarea" rows="8" placeholder="https://example.com/image1.jpg\nhttps://example.com/image2.jpg"></textarea>
                        </div>

                        <div class="flex justify-end">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i>Save Homepage Settings</button>
                        </div>
                    </form>
                </div>

                {/* --- Participants Import --- */}
                <div id="page-participants" class="admin-page hidden">
                     {/* ... [Participants content unchanged] ... */}
                     <h1 class="text-3xl font-bold text-gray-900 mb-6">Import Participants</h1>
                    <div class="info-text">
                        <strong>നിർദ്ദേശം:</strong> എല്ലാ മത്സരാർത്ഥികളെയും ഒരു CSV (Excel) ഫയൽ വഴി ഇവിടെ ഇമ്പോർട്ട് ചെയ്യാം.
                        <br>1. ആദ്യം <strong>"Download Template"</strong> ബട്ടൺ ക്ലിക്ക് ചെയ്ത് ഫയൽ ഡൗൺലോഡ് ചെയ്യുക.
                        <br>2. ആ Excel ഫയലിൽ <strong>Chest No, Name, Team</strong> എന്നീ കോളങ്ങൾ പൂരിപ്പിക്കുക. (ടീമിന്റെ പേര് Manage Teams-ൽ നൽകിയതുപോലെ കൃത്യമായിരിക്കണം, ഉദാ: BURAQ, DUL DUL).
                        <br>3. ആ ഫയൽ സേവ് ചെയ്ത ശേഷം, <strong>"Choose File"</strong> ഉപയോഗിച്ച് അപ്‌ലോഡ് ചെയ്ത് "Import Data" അമർത്തുക. ഓരോ തവണ ഇമ്പോർട്ട് ചെയ്യുമ്പോഴും പഴയ ഡാറ്റ മാറ്റി പുതിയത് ചേർക്കപ്പെടും.
                    </div>
                    
                    <div class="card mb-6">
                        <h2 class="card-header">Step 1: Download Template</h2>
                        <button id="download-template-btn" class="btn btn-secondary">
                            <i class="fas fa-download"></i> Download Template CSV
                        </button>
                    </div>

                    <div class="card mb-6">
                        <h2 class="card-header">Step 2: Upload CSV File</h2>
                        <form id="form-import-csv" class="space-y-4">
                            <div class="flex items-center gap-4">
                                <input type="file" id="csv-file-input" class="hidden" accept=".csv, text/csv">
                                <label for="csv-file-input" class="btn btn-light"><i class="fas fa-upload"></i> Choose File</label>
                                <span id="csv-filename" class="text-sm text-gray-500">No file chosen</span>
                            </div>
                             <button type="submit" class="btn btn-success"><i class="fas fa-file-import"></i> Import Data</button>
                        </form>
                        <div id="import-log-container" class="mt-6 hidden">
                            <h3 class="font-semibold text-lg mb-2">Import Log:</h3>
                            <pre id="import-log" class="bg-gray-900 text-white rounded-lg p-4 max-h-60 overflow-y-auto text-sm"></pre>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-header">Manage Participants Data</h2>
                        <p class="text-gray-600 mb-4">Total Participants in DB: <strong id="participant-count">0</strong></p>
                        <button id="delete-all-participants-btn" class="btn btn-danger">
                            <i class="fas fa-exclamation-triangle"></i> Delete All Participants
                        </button>
                        <p class="text-xs text-red-700 mt-2"><strong>Warning:</strong> ഇത് എല്ലാ പാർട്ടിസിപ്പന്റ് ഡാറ്റയും நிரந்தரமாக ഡിലീറ്റ് ചെയ്യും. പിന്നീട് തിരിച്ചെടുക്കാൻ സാധിക്കില്ല.</p>
                    </div>
                </div>

                {/* --- Programs & Categories --- */}
                <div id="page-programs" class="admin-page hidden">
                    {/* ... [Programs content unchanged] ... */}
                     <h1 class="text-3xl font-bold text-gray-900 mb-6">Manage Programs & Categories</h1>
                     <div class="info-text">
                        <strong>നിർദ്ദേശം:</strong> ഇവിടെ മത്സരങ്ങളുടെ കാറ്റഗറികളും (ഉദാ: Junior, Senior) ഓരോ മത്സരങ്ങളും ചേർക്കാം. ആദ്യം കാറ്റഗറികൾ ചേർക്കുക, പിന്നീട് പ്രോഗ്രാമുകൾ ചേർക്കുമ്പോൾ ആ കാറ്റഗറി തിരഞ്ഞെടുക്കാം.
                     </div>
                     {/* Manage Categories */}
                     <div class="card mb-8">
                         <h2 class="card-header">Manage Categories</h2>
                         <form id="form-add-category" class="mb-6 flex items-end gap-4">
                             <div class="flex-grow">
                                <label for="category-name" class="form-label">New Category Name</label>
                                <input type="text" id="category-name" class="form-input" placeholder="e.g., Junior" required>
                             </div>
                             <button type="submit" class="btn btn-success flex-shrink-0"><i class="fas fa-plus"></i>Add</button>
                         </form>
                         <div>
                             <h3 class="text-lg font-semibold text-gray-800 mb-3">Existing Categories</h3>
                             <div id="category-list" class="space-y-3">
                                 <p class="text-gray-500">Loading categories...</p>
                             </div>
                         </div>
                     </div>
                     {/* Manage Programs */}
                     <div class="card">
                         <h2 class="card-header">Manage Programs</h2>
                         <form id="form-add-program" class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                             <div class="md:col-span-1">
                                <label for="program-name" class="form-label">New Program Name</label>
                                <input type="text" id="program-name" class="form-input" placeholder="e.g., പ്രസംഗം" required>
                             </div>
                              <div class="md:col-span-1">
                                <label for="program-category" class="form-label">Category</label>
                                <select id="program-category" class="form-select" required>
                                    <option value="">Select Category</option>
                                    {/* Categories loaded by JS */}
                                </select>
                             </div>
                             <button type="submit" class="btn btn-success md:col-span-1"><i class="fas fa-plus"></i>Add Program</button>
                         </form>
                         <div>
                             <h3 class="text-lg font-semibold text-gray-800 mb-3">Existing Programs</h3>
                             <div id="program-list" class="space-y-3">
                                 <p class="text-gray-500">Loading programs...</p>
                             </div>
                         </div>
                     </div>
                </div>

                {/* --- Manage Teams (Improved UI) --- */}
                <div id="page-teams" class="admin-page hidden">
                    {/* ... [Teams content with improved UI from v6.2] ... */}
                     <h1 class="text-3xl font-bold text-gray-900 mb-6">Manage Teams</h1>
                    <div class="info-text">
                        <strong>നിർദ്ദേശം:</strong> പുതിയ ടീമുകളെ ചേർക്കാനും നിലവിലുള്ള ടീമുകളുടെ വിവരങ്ങൾ (ലീഡർ, അസിസ്റ്റന്റ് ലീഡർ, ചെസ്റ്റ് നമ്പർ പരിധി) മാറ്റം വരുത്താനും ഇവിടെ സാധിക്കും. ചെസ്റ്റ് നമ്പർ പരിധി (From, To) കൃത്യമായി നൽകുന്നത് റിസൾട്ട് പബ്ലിഷ് ചെയ്യുമ്പോൾ ടീമിനെ ഓട്ടോമാറ്റിക് ആയി കണ്ടെത്താൻ സഹായിക്കും.
                    </div>

                    {/* Add New Team Card */}
                    <div class="card mb-8">
                        <h2 class="card-header">Add New Team</h2>
                        <form id="form-add-team" class="space-y-4">
                            <div>
                                <label for="team-name" class="form-label">Team Name</label>
                                <input type="text" id="team-name" class="form-input" placeholder="e.g., BURAQ" required>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="team-leader" class="form-label">Leader Name</label>
                                    <input type="text" id="team-leader" class="form-input" placeholder="Leader's full name">
                                </div>
                                <div>
                                    <label for="team-asst" class="form-label">Asst. Leader Name</label>
                                    <input type="text" id="team-asst" class="form-input" placeholder="Assistant's full name">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                 <div>
                                    <label for="team-id-from" class="form-label">Chest No From</label>
                                    <input type="number" id="team-id-from" class="form-input" placeholder="e.g., 101">
                                </div>
                                <div>
                                    <label for="team-id-to" class="form-label">Chest No To</label>
                                    <input type="number" id="team-id-to" class="form-input" placeholder="e.g., 199">
                                </div>
                            </div>
                            <div class="flex justify-end pt-2">
                                <button type="submit" class="btn btn-success"><i class="fas fa-plus"></i>Add Team</button>
                            </div>
                        </form>
                    </div>

                    {/* Edit Existing Teams Card */}
                    <div class="card">
                         <h2 class="card-header">Edit Existing Teams</h2>
                         <div id="team-list-admin" class="space-y-6">
                             <p class="text-gray-500">Loading teams...</p>
                             {/* Team edit forms will be loaded here by JS */}
                         </div>
                    </div>
                </div>


                {/* --- Publish Results --- */}
                <div id="page-results" class="admin-page hidden">
                     {/* ... [Results content unchanged] ... */}
                     <h1 class="text-3xl font-bold text-gray-900 mb-6">Publish & Update Results</h1>
                    <div class="info-text">
                        <strong>നിർദ്ദേശം:</strong> ഒരു പ്രോഗ്രാം സെലക്ട് ചെയ്യുക. ശേഷം, വിജയിയുടെ ചെസ്റ്റ് നമ്പർ ടൈപ്പ് ചെയ്യുമ്പോൾ, പേര് ഓട്ടോമാറ്റിക്കായി വലതുവശത്ത് വരും (നിങ്ങൾ "Participants" ടാബിൽ നിന്ന് ഇമ്പോർട്ട് ചെയ്തിട്ടുണ്ടെങ്കിൽ). ഗ്രൂപ്പ് ഐറ്റം ആണെങ്കിൽ, ചെസ്റ്റ് നമ്പറിന് പകരം ടീമിന്റെ പേര് നൽകുക (ഉദാ: BURAQ). ഒന്നിൽ കൂടുതൽ വിജയികൾ ഉണ്ടെങ്കിൽ കോമ (,) ഇട്ട് വേർതിരിക്കുക.
                    </div>
                    <div class="card mb-6">
                        <form id="form-publish-result">
                            <div class="mb-6"> 
                                <label for="result-program" class="form-label">Select Program</label>
                                <select id="result-program" class="form-select" required>
                                    <option value="">Loading programs...</option>
                                </select>
                            </div>
                            
                            <div class="space-y-6"> 
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
                                    <div>
                                        <label for="result-first" class="form-label">1st Place (Chest No/Team)</label>
                                        <input type="text" id="result-first" class="form-input" placeholder="e.g., 101 or BURAQ">
                                    </div>
                                    <div class="pt-1 md:pt-7"> 
                                        <span id="name-first" class="text-sm font-medium text-indigo-600 block h-5"></span>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
                                    <div>
                                        <label for="result-second" class="form-label">2nd Place (Chest No/Team)</label>
                                        <input type="text" id="result-second" class="form-input" placeholder="e.g., 202">
                                     </div>
                                      <div class="pt-1 md:pt-7">
                                        <span id="name-second" class="text-sm font-medium text-indigo-600 block h-5"></span>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
                                    <div>
                                        <label for="result-third" class="form-label">3rd Place (Chest No/Team)</label>
                                        <input type="text" id="result-third" class="form-input" placeholder="e.g., 301">
                                    </div>
                                    <div class="pt-1 md:pt-7">
                                        <span id="name-third" class="text-sm font-medium text-indigo-600 block h-5"></span>
                                    </div>
                                </div>
                            </div>
                           
                            <div class="flex justify-end mt-8"> 
                                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i>Publish Result</button>
                            </div>
                        </form>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Firebase SDK & Admin Logic -->
    <script type="module">
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDBfnce5gtJhW9u1xwU2FVPQGx2KvG1vw8",
            authDomain: "result25.firebaseapp.com",
            projectId: "result25",
            storageBucket: "result25.firebasestorage.app",
            messagingSenderId: "1099340945335",
            appId: "1:1099340945335:web:4fdc63db6bf6b40a30ba32",
            measurementId: "G-S4BJW3N642" 
        };
        
        // Canvas Env Vars
        const appId = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId;
        const finalFirebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;
        finalFirebaseConfig.projectId = appId;

        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, addDoc, getDoc, getDocs, deleteDoc, collection, onSnapshot, query, writeBatch, updateDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
        
        // Initialize Firebase
        const app = initializeApp(finalFirebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- [JavaScript Logic - Includes RESTORED Auth + Previous Features] ---
        // Global state
        let allPrograms = [];
        let allCategories = [];
        let allParticipants = {}; 
        let allTeamsAdmin = {}; 

        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const adminPanel = document.getElementById('admin-panel');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const logoutButton = document.getElementById('logout-button');
        const adminEmail = document.getElementById('admin-email');
        const pages = document.querySelectorAll('.admin-page');
        const adminMenuOverlay = document.getElementById('admin-menu-overlay');
        const adminMenuBox = document.getElementById('admin-menu-box');
        const adminMenuBtn = document.getElementById('admin-menu-btn');
        const adminMenuCloseBtn = document.getElementById('admin-menu-close-btn');
        const navLinks = document.querySelectorAll('.menu-link');

        // ===================================
        // Navigation Logic 
        // ===================================
        function openAdminNav() { adminMenuOverlay.style.display = 'block'; setTimeout(() => { adminMenuOverlay.style.opacity = '1'; adminMenuBox.classList.add('open'); }, 10); }
        function closeAdminNav() { adminMenuOverlay.style.opacity = '0'; adminMenuBox.classList.remove('open'); setTimeout(() => { adminMenuOverlay.style.display = 'none'; }, 300); }
        adminMenuBtn.addEventListener('click', openAdminNav);
        adminMenuCloseBtn.addEventListener('click', closeAdminNav);
        adminMenuOverlay.addEventListener('click', (e) => { if (e.target === adminMenuOverlay) { closeAdminNav(); } });

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('data-target');
                pages.forEach(page => page.classList.add('hidden'));
                const targetPage = document.getElementById(targetId);
                if (targetPage) targetPage.classList.remove('hidden');
                navLinks.forEach(nav => nav.classList.remove('active'));
                link.classList.add('active');
                closeAdminNav();
                loadDataForPage(targetId);
            });
        });

        function loadDataForPage(pageId) {
             console.log("Loading data for:", pageId);
             if (pageId === 'page-dashboard') loadHomepageContent();
             if (pageId === 'page-participants') loadParticipantCount();
             if (pageId === 'page-programs') { loadCategories(); loadPrograms(); }
             if (pageId === 'page-results') loadProgramsForResults();
             if (pageId === 'page-teams') loadTeamsForAdmin();
        }

        // ===================================
        // Authentication (FIXED & COMPLETE)
        // ===================================
        onAuthStateChanged(auth, (user) => {
            if (user) {
                loginPage.style.display = 'none'; 
                adminPanel.style.display = 'block';
                adminEmail.textContent = user.email;
                // Activate the default page and load its data
                const defaultPageId = 'page-dashboard';
                pages.forEach(page => page.classList.add('hidden'));
                 const defaultPageElement = document.getElementById(defaultPageId);
                 if (defaultPageElement) defaultPageElement.classList.remove('hidden');

                navLinks.forEach(nav => nav.classList.remove('active'));
                const defaultNavLink = document.querySelector(`.menu-link[data-target="${defaultPageId}"]`);
                 if (defaultNavLink) defaultNavLink.classList.add('active');

                loadDataForPage(defaultPageId); // Load default page data
                loadAllParticipants(); // Load participants data on login
            } else {
                loginPage.style.display = 'flex'; 
                adminPanel.style.display = 'none';
            }
        });
        
        if(loginForm) {
            loginForm.addEventListener('submit', async (e) => { 
                e.preventDefault(); 
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                if (!email || !password) { alert("Please enter both email and password."); return; }
                try { 
                    await signInWithEmailAndPassword(auth, email, password); 
                } catch (error) { alert(`Login Failed: ${error.message}`); }
            });
        } else { console.error("Login form not found!"); }

        if(registerForm) {
            registerForm.addEventListener('submit', async (e) => { 
                e.preventDefault(); 
                 const email = document.getElementById('register-email').value;
                 const password = document.getElementById('register-password').value;
                 if (!email || !password) { alert("Please enter both email and password."); return; }
                try { 
                    await createUserWithEmailAndPassword(auth, email, password); 
                    alert('Admin user registered! Please login.'); 
                    registerForm.reset(); 
                } catch (error) { alert(`Registration Failed: ${error.message}`); }
            });
        } else { console.error("Register form not found!"); }

        if(logoutButton) {
            logoutButton.addEventListener('click', async () => { 
                try { await signOut(auth); } 
                catch(error) { alert(`Logout Failed: ${error.message}`); }
            });
        } else { console.error("Logout button not found!"); }

        // NEW: Password Toggle Functionality
        window.togglePasswordVisibility = function(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');
            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            } else {
                input.type = "password";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            }
        }

        // ===================================
        // Participants Page
        // ===================================
        // ... [Participants JS Code - Unchanged] ...
         const downloadTemplateBtn = document.getElementById('download-template-btn');
        const importForm = document.getElementById('form-import-csv');
        const fileInput = document.getElementById('csv-file-input');
        const fileNameEl = document.getElementById('csv-filename');
        const importLogContainer = document.getElementById('import-log-container');
        const importLog = document.getElementById('import-log');
        const participantCountEl = document.getElementById('participant-count');
        const deleteAllParticipantsBtn = document.getElementById('delete-all-participants-btn');
        
        function loadAllParticipants() {
            const participantsRef = collection(db, `artifacts/${appId}/public/data/participants`);
            onSnapshot(participantsRef, (snapshot) => {
                allParticipants = {};
                snapshot.docs.forEach(doc => { allParticipants[doc.id] = doc.data(); });
                loadParticipantCount();
                console.log('Participants data loaded:', Object.keys(allParticipants).length);
            }, (error) => { console.error("Error loading participants:", error); });
        }
        function loadParticipantCount() { participantCountEl.textContent = Object.keys(allParticipants).length; }
        downloadTemplateBtn.addEventListener('click', () => { const csvContent = "Chest No,Name,Team\n101,Fathima Sana,BURAQ\n102,Muhammed Ali,BURAQ\n201,Aysha,DUL DUL\n"; const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' }); const link = document.createElement("a"); const url = URL.createObjectURL(blob); link.setAttribute("href", url); link.setAttribute("download", "participants_template.csv"); link.style.visibility = 'hidden'; document.body.appendChild(link); link.click(); document.body.removeChild(link); });
        fileInput.addEventListener('change', (e) => { fileNameEl.textContent = e.target.files[0] ? e.target.files[0].name : 'No file chosen'; });

        importForm.addEventListener('submit', (e) => {
             e.preventDefault();
             const file = fileInput.files[0];
             if (!file) { alert("Please choose a CSV file to upload."); return; }
             importLogContainer.style.display = 'block';
             importLog.textContent = 'Starting import... Please wait.\nDeleting existing participants...\n';

             deleteAllParticipants(false) 
                 .then(() => {
                     importLog.textContent += 'Existing participants deleted.\nParsing CSV file...\n';
                     Papa.parse(file, {
                         header: true, skipEmptyLines: true,
                         complete: async (results) => {
                             const data = results.data;
                             if (!data.length || !data[0]["Chest No"] || !data[0]["Name"] || !data[0]["Team"]) {
                                 importLog.textContent += "ERROR: Invalid file format.\nMake sure columns are 'Chest No', 'Name', 'Team'.\nImport aborted.\n"; return;
                             }
                             importLog.textContent += `Found ${data.length} participants.\nImporting to database...\n`;
                             try {
                                 const batch = writeBatch(db); let importedCount = 0; let skippedCount = 0;
                                 data.forEach(row => {
                                     const chestNo = row["Chest No"] ? String(row["Chest No"]).trim() : null; 
                                     const name = row["Name"] ? row["Name"].trim() : null;
                                     const team = row["Team"] ? row["Team"].trim() : null;
                                     if (chestNo && name && team && /^\d+$/.test(chestNo)) { 
                                         const docRef = doc(db, `artifacts/${appId}/public/data/participants`, chestNo);
                                         batch.set(docRef, { name: name, team: team.toUpperCase() }); importedCount++;
                                     } else {
                                         importLog.textContent += `SKIPPED ROW: Invalid data ${JSON.stringify(row)}\n`; skippedCount++;
                                     }
                                 });
                                 await batch.commit();
                                 importLog.textContent += `\nSUCCESS: Imported ${importedCount} participants. Skipped ${skippedCount} rows.\n`;
                                 fileInput.value = null; fileNameEl.textContent = 'No file chosen';
                             } catch (error) { importLog.textContent += `\nIMPORT ERROR: ${error.message}\n`; }
                         },
                         error: (error) => { importLog.textContent += `\nCSV PARSE ERROR: ${error.message}\n`; }
                     });
                 })
                 .catch(error => {
                     importLog.textContent += `\nERROR DELETING OLD DATA: ${error.message}\nImport aborted.\n`;
                 });
        });

        async function deleteAllParticipants(promptUser = true) {
             let confirmation = 'DELETE'; 
             if (promptUser) {
                 confirmation = prompt('This will delete ALL participants. Type DELETE to confirm.');
             }
             if (confirmation !== 'DELETE') {
                 if (promptUser) alert('Deletion cancelled.');
                 return Promise.reject('Deletion cancelled by user or skipped.'); 
             }
             try {
                 if (promptUser) alert('Deleting participants...');
                 const snapshot = await getDocs(collection(db, `artifacts/${appId}/public/data/participants`));
                 if (snapshot.empty && promptUser) {
                     alert('No participants found to delete.');
                     return Promise.resolve(); 
                 }
                 const batch = writeBatch(db);
                 snapshot.docs.forEach(doc => { batch.delete(doc.ref); });
                 await batch.commit();
                 if (promptUser) alert('All participants have been deleted.');
                 loadAllParticipants(); 
                 return Promise.resolve(); 
             } catch (error) {
                 if (promptUser) alert(`Error deleting participants: ${error.message}`);
                 return Promise.reject(error); 
             }
        }
        deleteAllParticipantsBtn.addEventListener('click', () => deleteAllParticipants(true)); 

        // ===================================
        // Programs & Categories Page
        // ===================================
        // ... [Programs & Categories JS Code - Unchanged] ...
         const categoryForm = document.getElementById('form-add-category');
        const categoryInput = document.getElementById('category-name');
        const categoryList = document.getElementById('category-list');
        const programForm = document.getElementById('form-add-program');
        const programNameInput = document.getElementById('program-name');
        const programCategorySelect = document.getElementById('program-category');
        const programList = document.getElementById('program-list');

        async function loadCategories() {
             const snapshot = await getDocs(collection(db, `artifacts/${appId}/public/data/categories`));
             allCategories = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a,b)=>a.name.localeCompare(b.name));
             categoryList.innerHTML = ''; // Clear existing list
             programCategorySelect.innerHTML = '<option value="">Select Category</option>'; // Clear and add default
             if (allCategories.length === 0) {
                 categoryList.innerHTML = '<p class="text-gray-500 italic">No categories added yet.</p>';
             } else {
                 allCategories.forEach(cat => {
                     categoryList.innerHTML += `
                         <div class="list-item">
                             <span class="list-item-name">${cat.name}</span>
                             <button class="btn btn-danger btn-sm btn-icon-only" onclick="deleteCategory('${cat.id}')" title="Delete Category">
                                 <i class="fas fa-trash-alt"></i>
                             </button>
                         </div>`;
                     programCategorySelect.innerHTML += `<option value="${cat.name}">${cat.name}</option>`;
                 });
             }
        }

        categoryForm.addEventListener('submit', async (e) => { e.preventDefault(); const name = categoryInput.value.trim(); if (!name) return; try { await addDoc(collection(db, `artifacts/${appId}/public/data/categories`), { name }); categoryInput.value = ''; loadCategories(); } catch (error) { alert(`Error: ${error.message}`); }});
        window.deleteCategory = async (id) => { if (!confirm('Are you sure you want to delete this category?')) return; try { await deleteDoc(doc(db, `artifacts/${appId}/public/data/categories`, id)); loadCategories(); } catch (error) { alert(`Error: ${error.message}`); }};

        async function loadPrograms() {
             const snapshot = await getDocs(collection(db, `artifacts/${appId}/public/data/programs`));
             allPrograms = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a,b)=>a.name.localeCompare(b.name));
             programList.innerHTML = '';
             if (allPrograms.length === 0) {
                  programList.innerHTML = '<p class="text-gray-500 italic">No programs added yet.</p>';
             } else {
                 allPrograms.forEach(prog => {
                     programList.innerHTML += `
                         <div class="list-item">
                             <div class="list-item-content">
                                <span class="list-item-name">${prog.name}</span>
                                <span class="list-item-details">${prog.category}</span>
                             </div>
                             <button class="btn btn-danger btn-sm btn-icon-only" onclick="deleteProgram('${prog.id}')" title="Delete Program">
                                 <i class="fas fa-trash-alt"></i>
                             </button>
                         </div>`;
                 });
             }
        }
        programForm.addEventListener('submit', async (e) => { e.preventDefault(); const name = programNameInput.value.trim(); const category = programCategorySelect.value; if (!name || !category) return; try { await addDoc(collection(db, `artifacts/${appId}/public/data/programs`), { name, category }); programNameInput.value = ''; programCategorySelect.value = ''; loadPrograms(); } catch (error) { alert(`Error: ${error.message}`); }});
        window.deleteProgram = async (id) => { if (!confirm('Are you sure you want to delete this program?')) return; try { await deleteDoc(doc(db, `artifacts/${appId}/public/data/programs`, id)); // Also delete result if exists await deleteDoc(doc(db, `artifacts/${appId}/public/data/results`, id)); loadPrograms(); } catch (error) { alert(`Error: ${error.message}`); }};


        // ===================================
        // Results Page
        // ===================================
        // ... [Results JS Code - Unchanged] ...
         const resultForm = document.getElementById('form-publish-result');
        const resultProgramSelect = document.getElementById('result-program');
        const resultInputs = { 'first': document.getElementById('result-first'), 'second': document.getElementById('result-second'), 'third': document.getElementById('result-third') };
        const nameSpans = { 'first': document.getElementById('name-first'), 'second': document.getElementById('name-second'), 'third': document.getElementById('name-third') };

        function updateWinnerName(position) { const chestNoInput = resultInputs[position].value.trim(); const chestNos = chestNoInput.split(',').map(s => s.trim()).filter(Boolean); const names = chestNos.map(cn => allParticipants[cn]?.name || (Object.keys(allTeamsAdmin).includes(cn.toUpperCase()) ? cn.toUpperCase() : 'Unknown')).join(', '); nameSpans[position].textContent = names; }
        resultInputs.first.addEventListener('input', () => updateWinnerName('first'));
        resultInputs.second.addEventListener('input', () => updateWinnerName('second'));
        resultInputs.third.addEventListener('input', () => updateWinnerName('third'));
        function clearNamePreviews() { nameSpans.first.textContent = ''; nameSpans.second.textContent = ''; nameSpans.third.textContent = ''; }

        async function loadProgramsForResults() { await loadPrograms(); await loadCategories(); // Ensure categories are loaded for sorting resultProgramSelect.innerHTML = '<option value="">Select a Program</option>'; const categoryOrder = allCategories.map(c => c.name); // Get category order allPrograms.sort((a, b) => { // Sort by category first, then name const catAIndex = categoryOrder.indexOf(a.category); const catBIndex = categoryOrder.indexOf(b.category); if (catAIndex !== catBIndex) { return catAIndex - catBIndex; } return a.name.localeCompare(b.name); }); allPrograms.forEach(program => { resultProgramSelect.innerHTML += `<option value="${program.id}">${program.name} (${program.category})</option>`; }); }


        resultProgramSelect.addEventListener('change', async (e) => {
            const programId = e.target.value;
            resultForm.reset(); // Reset form first
             clearNamePreviews();
             document.getElementById('result-program').value = programId; // Re-select the program

            if (!programId) return;

            const docSnap = await getDoc(doc(db, `artifacts/${appId}/public/data/results`, programId));
            if (docSnap.exists()) {
                const data = docSnap.data();
                resultInputs.first.value = data.first ? data.first.map(w => w.chest).join(', ') : '';
                resultInputs.second.value = data.second ? data.second.map(w => w.chest).join(', ') : '';
                resultInputs.third.value = data.third ? data.third.map(w => w.chest).join(', ') : '';
                updateWinnerName('first'); updateWinnerName('second'); updateWinnerName('third');
            }
        });

        resultForm.addEventListener('submit', async (e) => {
            e.preventDefault(); const programId = resultProgramSelect.value; if (!programId) { alert('Please select a program.'); return; }
            const mapToWinnerData = (id) => { const chestList = document.getElementById(id).value.split(',').map(s => s.trim()).filter(Boolean); return chestList.map(chest => ({ chest: chest, name: allParticipants[chest]?.name || (Object.keys(allTeamsAdmin).includes(chest.toUpperCase()) ? chest.toUpperCase() : 'Unknown') })); };
            const resultData = { first: mapToWinnerData('result-first'), second: mapToWinnerData('result-second'), third: mapToWinnerData('result-third') };
            try { await setDoc(doc(db, `artifacts/${appId}/public/data/results`, programId), resultData); alert('Result published!'); } catch (error) { alert(`Error: ${error.message}`); }
        });


        // ===================================
        // Teams Page (Admin)
        // ===================================
        // ... [Teams JS Code - Unchanged] ...
         const teamForm = document.getElementById('form-add-team');
        const teamListAdmin = document.getElementById('team-list-admin');

        async function loadTeamsForAdmin() {
            const snapshot = await getDocs(collection(db, `artifacts/${appId}/public/data/teams`));
            allTeamsAdmin = {}; // Reset
            snapshot.docs.forEach(doc => { allTeamsAdmin[doc.id] = { id: doc.id, ...doc.data() }; });
            renderAdminTeamList();
        }

        function renderAdminTeamList() {
             teamListAdmin.innerHTML = ''; // Clear previous list
             if (Object.keys(allTeamsAdmin).length === 0) {
                 teamListAdmin.innerHTML = '<p class="text-gray-500 italic">No teams added yet.</p>';
                 return;
             }
             const sortedTeams = Object.values(allTeamsAdmin).sort((a, b) => a.name.localeCompare(b.name));
             sortedTeams.forEach(team => {
                 const teamElement = document.createElement('div');
                 teamElement.className = 'border border-gray-200 rounded-lg p-4 mb-4 bg-gray-50'; 
                 teamElement.innerHTML = `
                     <h3 class="text-xl font-bold text-gray-800 mb-4">${team.name}</h3>
                     <form class="space-y-4" data-team-id="${team.id}">
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                <label class="form-label">Leader Name</label>
                                <input type="text" class="form-input" value="${team.leader || ''}" data-field="leader">
                             </div>
                              <div>
                                <label class="form-label">Asst. Leader Name</label>
                                <input type="text" class="form-input" value="${team.asst || ''}" data-field="asst">
                             </div>
                         </div>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                 <label class="form-label">Chest No From</label>
                                 <input type="number" class="form-input" value="${team.id_from || ''}" data-field="id_from">
                             </div>
                             <div>
                                 <label class="form-label">Chest No To</label>
                                 <input type="number" class="form-input" value="${team.id_to || ''}" data-field="id_to">
                             </div>
                         </div>
                         <div class="flex justify-end gap-3 pt-2">
                              <button type="button" class="btn btn-danger btn-sm" onclick="deleteTeam('${team.id}')"><i class="fas fa-trash-alt"></i>Delete</button>
                              <button type="submit" class="btn btn-secondary btn-sm"><i class="fas fa-sync-alt"></i>Update Team</button>
                         </div>
                     </form>
                 `;
                 teamListAdmin.appendChild(teamElement);
                 const updateForm = teamElement.querySelector('form');
                 updateForm.addEventListener('submit', handleUpdateTeam);
             });
        }

        teamForm.addEventListener('submit', async (e) => {
             e.preventDefault();
             const name = document.getElementById('team-name').value.trim().toUpperCase(); 
             const leader = document.getElementById('team-leader').value.trim();
             const asst = document.getElementById('team-asst').value.trim();
             const id_from = document.getElementById('team-id-from').value;
             const id_to = document.getElementById('team-id-to').value;
             if (!name) { alert("Team Name is required."); return; }
             const teamData = { name, leader, asst };
             if (id_from) teamData.id_from = parseInt(id_from, 10);
             if (id_to) teamData.id_to = parseInt(id_to, 10);
             try {
                 await setDoc(doc(db, `artifacts/${appId}/public/data/teams`, name), teamData); 
                 alert(`Team ${name} added successfully!`);
                 teamForm.reset();
                 loadTeamsForAdmin(); // Refresh list
             } catch (error) { alert(`Error adding team: ${error.message}`); }
        });

        async function handleUpdateTeam(e) {
             e.preventDefault();
             const form = e.target;
             const teamId = form.dataset.teamId; 
             if (!teamId) return;
             const updatedData = { name: teamId };
             form.querySelectorAll('input[data-field]').forEach(input => {
                 const field = input.dataset.field;
                 let value = input.value.trim();
                 if (field === 'id_from' || field === 'id_to') {
                     value = value ? parseInt(value, 10) : null; 
                 }
                 updatedData[field] = value;
             });
             try {
                 await setDoc(doc(db, `artifacts/${appId}/public/data/teams`, teamId), updatedData);
                 alert(`Team ${teamId} updated successfully!`);
                 allTeamsAdmin[teamId] = { id: teamId, ...updatedData }; 
             } catch (error) { alert(`Error updating team: ${error.message}`); }
        }

        window.deleteTeam = async (id) => {
             if (!confirm(`Are you sure you want to delete team ${id}? This cannot be undone.`)) return;
             try {
                 await deleteDoc(doc(db, `artifacts/${appId}/public/data/teams`, id));
                 alert(`Team ${id} deleted successfully!`);
                 delete allTeamsAdmin[id]; 
                 renderAdminTeamList(); 
             } catch (error) { alert(`Error deleting team: ${error.message}`); }
        };


        // ===================================
        // Home Page Content (Admin)
        // ===================================
        // ... [Homepage JS Code - Unchanged] ...
         const homepageForm = document.getElementById('form-homepage');
        const homepageFields = {
            logo_url: document.getElementById('homepage-logo-url'),
            main_title: document.getElementById('homepage-main-title'),
            subtitle: document.getElementById('homepage-subtitle'),
            about: document.getElementById('homepage-about'),
            about_image_url: document.getElementById('homepage-about-image-url'),
            gallery: document.getElementById('homepage-gallery'),
            total_programs: document.getElementById('homepage-total-programs'),
            total_participants: document.getElementById('homepage-total-participants'),
            total_categories: document.getElementById('homepage-total-categories'),
            total_teams: document.getElementById('homepage-total-teams')
        };

        async function loadHomepageContent() {
             const docSnap = await getDoc(doc(db, `artifacts/${appId}/public/data/config`, 'homepage'));
             if (docSnap.exists()) {
                 const data = docSnap.data();
                 homepageFields.logo_url.value = data.logo_url || '';
                 homepageFields.main_title.value = data.main_title || '';
                 homepageFields.subtitle.value = data.subtitle || '';
                 homepageFields.about.value = data.about || '';
                 homepageFields.about_image_url.value = data.about_image_url || '';
                 homepageFields.gallery.value = (data.gallery || []).join('\n');
                 homepageFields.total_programs.value = data.total_programs || '';
                 homepageFields.total_participants.value = data.total_participants || '';
                 homepageFields.total_categories.value = data.total_categories || '';
                 homepageFields.total_teams.value = data.total_teams || '';
             }
        }

        homepageForm.addEventListener('submit', async (e) => {
             e.preventDefault();
             const galleryArray = homepageFields.gallery.value.split('\n').map(url => url.trim()).filter(Boolean);
             const dataToSave = {
                 logo_url: homepageFields.logo_url.value.trim(),
                 main_title: homepageFields.main_title.value.trim(),
                 subtitle: homepageFields.subtitle.value.trim(),
                 about: homepageFields.about.value.trim(),
                 about_image_url: homepageFields.about_image_url.value.trim(),
                 gallery: galleryArray,
                 total_programs: homepageFields.total_programs.value.trim(),
                 total_participants: homepageFields.total_participants.value.trim(),
                 total_categories: homepageFields.total_categories.value.trim(),
                 total_teams: homepageFields.total_teams.value.trim(),
             };
             try {
                 await setDoc(doc(db, `artifacts/${appId}/public/data/config`, 'homepage'), dataToSave);
                 alert('Homepage settings saved!');
             } catch (error) { alert(`Error saving settings: ${error.message}`); }
        });

    </script>
</body>
</html>

